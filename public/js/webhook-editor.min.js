window.webhook={loadEvents:function(){$.ajax({url:"https://api.spiget.org/v2/webhook/events?spiget___ua=SpigetWebhooks&callback=?",success:function(e){$.each(e.events,function(e,t){$("#events_group").append("<input type='checkbox' class='webhook-event' value='"+t+"'> "+t+"<br/>")})}})},ignoreConnection:!0,testConnection:function(url,event,callback){if(webhook.ignoreConnection){callback(!0);return}$("#registerButton").prop("disabled",!0),Alert.alert("info","Testing connection...",!0),$.ajax({url:"https://tools.inventivetalent.org/connection/ping.php?spiget___ua=SpigetWebhooks&callback=?&method=POST&url="+btoa(url),success:function(e){e.success?($("#registerButton").prop("disabled",!1),Alert.alert("success","Connection was successful",!0),callback(!0)):(Alert.alert("danger","",!0),$("#footer_alert_value").append("Connection failed. Status code: "+err.code+" | If you are sure it will work anyway, <a href='#' id='ignoreConnection'>click here</a>"),callback(!1))},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");void 0===err&&(err={code:-1}),Alert.alert("danger","",!0),$("#footer_alert_value").append("Connection failed. Status code: "+err.code+" | If you are sure it will work anyway, <a href='#' id='ignoreConnection'>click here</a>"),callback(!1)}})},register:function(url,events){$("#registerButton").prop("disabled",!0),$("#webhookId").val(""),$("#webhookSecret").val(""),$.ajax({url:"https://api.spiget.org/v2/webhook/register?spiget___ua=SpigetWebhooks&",method:"POST",type:"POST",data:{url:url,events:JSON.stringify(events)},success:function(e){$("#webhookId").val(e.id),$("#webhookSecret").val(e.secret),Alert.alert("success","Webhook created. Make sure to save the ID & Secret!",!0),$("#registerButton").prop("disabled",!1)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");Alert.alert("danger","Error: "+err.error,!0),$("#registerButton").prop("disabled",!1)}})},remove:function(id,secret){$("#removeButton").prop("disabled",!0),$.ajax({url:"https://api.spiget.org/v2/webhook/delete/"+id+"/"+secret+"?spiget___ua=SpigetWebhooks&",method:"DELETE",type:"DELETE",success:function(e){Alert.alert("success","Webhook removed",!0),$("#removeButton").prop("disabled",!1)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");void 0===err&&(err={code:-1}),Alert.alert("danger","Error: "+err.error,!0),$("#removeButton").prop("disabled",!1)}})}},$(document).ready(function(){webhook.loadEvents();var e=function(){var e=!1;(e=0==$("#targetUrl").val().trim().length)||(c=0,$("input.webhook-event:checked").each(function(){c++}),console.log(c),e=!(c>0)),$("#registerButton").prop("disabled",e)};$("#targetUrl").on("keyup change",e),$(document).on("change","input.webhook-event",e);var t=function(){0==$("#delete-id").val().trim().length||0==$("#delete-secret").val().trim().length?$("#deleteButton").prop("disabled",!0):$("#deleteButton").prop("disabled",!1)};$("#delete-id").on("keyup change",t),$("#delete-secret").on("keyup change",t),$("#registerButton").click(function(e){e.preventDefault(),$url=$("#targetUrl").val(),$events=[],$("input.webhook-event:checked").each(function(){$events.push($(this).val())}),webhook.testConnection($url,$events[0],function(e){e&&setTimeout(function(){webhook.register($url,$events)},200)})}),$("#deleteButton").click(function(e){e.preventDefault(),$id=$("#delete-id"),$secret=$("#delete-secret"),webhook.remove($id.val().trim(),$secret.val().trim())}),$(document).on("click","#ignoreConnection",function(e){e.preventDefault(),webhook.ignoreConnection=!0,$("#registerButton").prop("disabled",!1)})});
